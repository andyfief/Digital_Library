<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Book Genres - Library System</title>
    <style>
        /* Main body styling with clean font and margins */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        
        /* Header section styling */
        header {
            margin-bottom: 20px;
        }
        
        /* Main heading colors */
        h1, h2 {
            color: #333;
        }
        
        /* Table styling with full width and collapsed borders */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        
        /* Header row styling with light gray background */
        th {
            background-color: #f2f2f2;
        }
        
        /* Form container styling */
        form {
            max-width: 600px;
            margin-bottom: 30px;
        }
        
        /* Label styling with block display for vertical stacking */
        label {
            display: block;
            margin-top: 10px;
        }
        
        /* Input and select field styling */
        input, select {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            box-sizing: border-box;
        }
        
        /* Button styling with green theme */
        button {
            padding: 8px 16px;
            margin-top: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        
        /* Action button spacing */
        .actions button {
            margin-right: 5px;
        }
        
        /* Navigation links styling */
        .nav-links {
            margin-bottom: 20px;
        }
        
        /* Edit form container styling */
        .edit-form {
            background-color: #f9f9f9;
            padding: 20px;
            border: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        /* Message styling for success and error notifications */
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <!-- Main header with navigation links -->
    <header>
        <h1>Book Genres Management</h1>
        <div class="nav-links">
            <a href="index.html">Home</a> |
            <a href="books.html">Books</a> |
            <a href="authors.html">Authors</a> |
            <a href="genres.html">Genres</a> |
            <a href="users.html">Users</a> |
            <a href="rentals.html">Rentals</a> |
            <a href="update_book_genres.html">Book Genres</a>
        </div>
    </header>

    <!-- Message container for displaying success/error messages -->
    <div id="message"></div>

    <!-- Add new book-genre relationship form section -->
    <section>
        <h2>Add Book-Genre Relationship</h2>
        <form id="addRelationshipForm">
            <!-- Book selection dropdown -->
            <div>
                <label for="book">Select Book:</label>
                <select id="book" name="book_id" required>
                    <option value="">Choose a book</option>
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            
            <!-- Genre selection dropdown -->
            <div>
                <label for="genre">Select Genre:</label>
                <select id="genre" name="genre_id" required>
                    <option value="">Choose a genre</option>
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            
            <button type="submit">Add Book-Genre Relationship</button>
        </form>
    </section>

    <!-- Edit existing book-genre relationship form section -->
    <section>
        <h2>Edit Book-Genre Relationship</h2>
        <form id="editRelationshipForm">
            <!-- Relationship selection dropdown for editing -->
            <div>
                <label for="edit_relationship_id">Select Relationship to Edit:</label>
                <select id="edit_relationship_id" name="relationship_id" onchange="loadRelationshipData()" required>
                    <option value="">Select Relationship to Edit</option>
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            
            <!-- Book selection for editing -->
            <div>
                <label for="edit_book">Book:</label>
                <select id="edit_book" name="book_id" required>
                    <option value="">Select Book</option>
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            
            <!-- Genre selection for editing -->
            <div>
                <label for="edit_genre">Genre:</label>
                <select id="edit_genre" name="genre_id" required>
                    <option value="">Select Genre</option>
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            
            <button type="submit">Update Relationship</button>
            <button type="button" onclick="clearEditForm()">Clear Form</button>
        </form>
    </section>

    <!-- Book-genre relationships data table section -->
    <section>
        <h2>Book-Genre Relationships</h2>
        <p>This table shows which books belong to which genres. Data populated with: <code>SELECT * FROM Genres_Has_Books;</code></p>
        <table>
            <thead>
                <tr>
                    <th>Relationship ID</th>
                    <th>Book Title</th>
                    <th>Genre Name</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="relationshipsTableBody">
                <!-- Data will be populated by JavaScript -->
            </tbody>
        </table>
    </section>

    <script>
        // General Citations for Update_Book_Genres.html Script:
        // Ai was used to add various try/catch blocks and response checks.
        // For example, if (!tbody) return; (populateRelationshipsTable())
        // This was often done with a single prompt when encountering issues after implementing a single function.
        // An example prompt might be, "Im having trouble with this function. Add try/catch blocks and use the showMessage function or console.log()
        // To help me debug the function."
        // AI Source URL: https://claude.ai
        // Citations below this may say "All my work", however, this citation should be inferred.

        console.log('[INIT] Relationships script loaded');
        
        // global arrays to store data, avoids needing to refetch from the API multiple times
        let allRelationships = [];
        let allBooks = [];
        let allGenres = [];

        // Citation for showMessage:
        // This function is directly based off of the showMessage function in rentals.html, which is all my own work.
        // AI was used to transform the rentals function into the book-genre relationships function.
        // Prompt: Take this showMessage function and modify it to fit my book-genre relationships page. [Paste in showMessage function, Relationships page section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // This function differs in the sense that it displays messages for relationship operations instead of rental operations.
        // Displays a success or error message and disappears after 5 seconds.
        function showMessage(message, type = 'success') {
            // log the message type and content to console for debugging
            console.log(`[MESSAGE] ${type.toUpperCase()}: ${message}`);
            
            // get the message display container from the DOM
            const messageDiv = document.getElementById('message');
            
            // inject the message with appropriate styling class (success or error)
            messageDiv.innerHTML = `<div class="message ${type}">${message}</div>`;
            
            // set a timer to automatically clear the message after 5 seconds
            setTimeout(() => {
                // clears the message after 5 seconds to avoid cluttering the UI
                messageDiv.innerHTML = '';
            }, 5000);
        }

        // Citation for getBookTitle helper function:
        // This function is all my own work.
        // Helper function to get book title by ID from cached data
        function getBookTitle(bookId) {
            // search through cached books array to find matching ID
            const book = allBooks.find(b => b.book_id == bookId);
            
            // return the book title if found, otherwise return a fallback string
            return book ? book.title : `Book ${bookId}`;
        }

        // Citation for getGenreTitle helper function:
        // This function is all my own work.
        // Helper function to get genre title by ID from cached data
        function getGenreTitle(genreId) {
            // search through cached genres array to find matching ID
            const genre = allGenres.find(g => g.genre_id == genreId);
            
            // return the genre title if found, otherwise return a fallback string
            return genre ? genre.title : `Genre ${genreId}`;
        }

        // Citation for loadBooks:
        // This function is directly based off of the loadRentals function in rentals.html, which was generated with AI.
        // AI was used to transform the rentals function into the books function for dropdown population.
        // Prompt: Take this loadRentals function and modify it to fit my books dropdown loading. [Paste in loadRentals function, Books dropdown section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // This function differs in the sense that it loads book data for dropdown population instead of rental data for table display.
        // gets book data from the server for dropdown population
        async function loadBooks() {
            console.log('[LOAD] Loading books for dropdowns...');
            try {
                // start by making a GET request to retrieve book data
                const response = await fetch('/api/books');
                
                // if the response is not OK (e.g., 404, 500), throw an error
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // fetch the raw text (HTML or mixed response body)
                const htmlResponse = await response.text();
                
                // extract JSON array string using regex, assuming it's embedded within HTML
                const jsonMatch = htmlResponse.match(/\[.*\]/);
                if (!jsonMatch) {
                    throw new Error('No JSON data found in books response');
                }
                
                // grab the matched JSON substring and parse it
                allBooks = JSON.parse(jsonMatch[0]);
                console.log('[LOAD] Loaded books:', allBooks.length);
                
                // populate both add and edit form dropdowns with book data
                populateBookDropdowns();
            } catch (error) {
                // catch network or JSON parse errors and inform the user
                console.error('[LOAD] Error loading books:', error);
                showMessage('Error loading books: ' + error.message, 'error');
            }
        }

        // Citation for loadGenres:
        // This function is directly based off of the loadRentals function in rentals.html, which was generated with AI.
        // AI was used to transform the rentals function into the genres function for dropdown population.
        // Prompt: Take this loadRentals function and modify it to fit my genres dropdown loading. [Paste in loadRentals function, Genres dropdown section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // This function differs in the sense that it loads genre data for dropdown population instead of rental data for table display.
        // gets genre data from the server for dropdown population
        async function loadGenres() {
            console.log('[LOAD] Loading genres for dropdowns...');
            try {
                // start by making a GET request to retrieve genre data
                const response = await fetch('/api/genres');
                
                // if the response is not OK (e.g., 404, 500), throw an error
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // fetch the raw text (HTML or mixed response body)
                const htmlResponse = await response.text();
                
                // extract JSON array string using regex, assuming it's embedded within HTML
                const jsonMatch = htmlResponse.match(/\[.*\]/);
                if (!jsonMatch) {
                    throw new Error('No JSON data found in genres response');
                }
                
                // grab the matched JSON substring and parse it
                allGenres = JSON.parse(jsonMatch[0]);
                console.log('[LOAD] Loaded genres:', allGenres.length);
                
                // populate both add and edit form dropdowns with genre data
                populateGenreDropdowns();
            } catch (error) {
                // catch network or JSON parse errors and inform the user
                console.error('[LOAD] Error loading genres:', error);
                showMessage('Error loading genres: ' + error.message, 'error');
            }
        }

        // Citation for loadRelationships:
        // This function is directly based off of the loadRentals function in rentals.html, which was generated with AI.
        // AI was used to transform the rentals function into the relationships function.
        // Prompt: Take this loadRentals function and modify it to fit my relationships page. [Paste in loadRentals function, Relationships page section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // This function differs in the sense that it loads relationship data instead of rental data, but AI tools were still used to generate the function that this one is derived from.
        // gets relationship data from the server and updates the UI
        async function loadRelationships() {
            console.log('[LOAD] loadRelationships() called');
            try {
                // start by making a GET request to retrieve relationship data
                console.log('[LOAD] Fetching from /api/relationships...');
                const response = await fetch('/api/relationships'); // sends GET request to relationships API
                console.log('[LOAD] Response status:', response.status);
                
                // if the response is not OK (e.g., 404, 500), throw an error
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // fetch the raw text (HTML or mixed response body)
                const htmlResponse = await response.text();
                console.log('[LOAD] Raw response length:', htmlResponse.length);
                
                // extract JSON array string using regex, assuming it's embedded within HTML
                const jsonMatch = htmlResponse.match(/\[.*\]/);
                
                // if no match is found, assume the response format is invalid
                if (!jsonMatch) {
                    throw new Error('No JSON data found in response');
                }
                
                // grab the matched JSON substring and parse it
                const jsonString = jsonMatch[0];
                console.log('[LOAD] Extracted JSON string length:', jsonString.length);
                
                const relationships = JSON.parse(jsonString);
                console.log('[LOAD] Parsed relationships data:', relationships);
                
                // store result globally to avoid re-fetching later
                allRelationships = relationships;
                
                // refresh the relationship display and dropdown with latest data
                populateRelationshipsTable(relationships);
                populateEditDropdown(relationships);
                
                console.log(`[LOAD] Successfully loaded ${relationships.length} relationships`);
                
            } catch (error) {
                // catch network or JSON parse errors and inform the user
                console.error('[LOAD] Error in loadRelationships:', error);
                showMessage('Error loading relationships: ' + error.message, 'error');
            }
        }

        // Citation for populateBookDropdowns:
        // This function is directly based off of the populateEditDropdown function in rentals.html, which is all my own work.
        // AI was used to transform the rentals function into the books dropdown function.
        // Prompt: Take this populateEditDropdown function and modify it to fit my books dropdowns. [Paste in populateEditDropdown function, Books dropdown section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // This function differs in the sense that it populates book dropdowns instead of rental dropdown, and handles both add and edit forms.
        // fills both add and edit form dropdowns with available books
        function populateBookDropdowns() {
            console.log('[DROPDOWN] Populating book dropdowns');
            
            // populate add form dropdown with books
            const addSelect = document.getElementById('book');
            if (addSelect) {
                // reset the dropdown with just the default "choose one" option
                addSelect.innerHTML = '<option value="">Choose a book</option>';
                
                // add each book as a selectable option in the add form dropdown
                allBooks.forEach(book => {
                    // create a new option element for this book
                    const option = document.createElement('option');
                    
                    // set the option's value to the book ID (what gets submitted)
                    option.value = book.book_id;
                    
                    // set the display text to show the book title
                    option.textContent = book.title;
                    
                    // add this option to the dropdown
                    addSelect.appendChild(option);
                });
            }
            
            // populate edit form dropdown with books
            const editSelect = document.getElementById('edit_book');
            if (editSelect) {
                // reset the dropdown with just the default "select one" option
                editSelect.innerHTML = '<option value="">Select Book</option>';
                
                // add each book as a selectable option in the edit form dropdown
                allBooks.forEach(book => {
                    // create a new option element for this book
                    const option = document.createElement('option');
                    
                    // set the option's value to the book ID (what gets submitted)
                    option.value = book.book_id;
                    
                    // set the display text to show the book title
                    option.textContent = book.title;
                    
                    // add this option to the dropdown
                    editSelect.appendChild(option);
                });
            }
        }

        // Citation for populateGenreDropdowns:
        // This function is directly based off of the populateEditDropdown function in rentals.html, which is all my own work.
        // AI was used to transform the rentals function into the genres dropdown function.
        // Prompt: Take this populateEditDropdown function and modify it to fit my genres dropdowns. [Paste in populateEditDropdown function, Genres dropdown section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // This function differs in the sense that it populates genre dropdowns instead of rental dropdown, and handles both add and edit forms.
        // fills both add and edit form dropdowns with available genres
        function populateGenreDropdowns() {
            console.log('[DROPDOWN] Populating genre dropdowns');
            
            // populate add form dropdown with genres
            const addSelect = document.getElementById('genre');
            if (addSelect) {
                // reset the dropdown with just the default "choose one" option
                addSelect.innerHTML = '<option value="">Choose a genre</option>';
                
                // add each genre as a selectable option in the add form dropdown
                allGenres.forEach(genre => {
                    // create a new option element for this genre
                    const option = document.createElement('option');
                    
                    // set the option's value to the genre ID (what gets submitted)
                    option.value = genre.genre_id;
                    
                    // set the display text to show the genre title
                    option.textContent = genre.title;
                    
                    // add this option to the dropdown
                    addSelect.appendChild(option);
                });
            }
            
            // populate edit form dropdown with genres
            const editSelect = document.getElementById('edit_genre');
            if (editSelect) {
                // reset the dropdown with just the default "select one" option
                editSelect.innerHTML = '<option value="">Select Genre</option>';
                
                // add each genre as a selectable option in the edit form dropdown
                allGenres.forEach(genre => {
                    // create a new option element for this genre
                    const option = document.createElement('option');
                    
                    // set the option's value to the genre ID (what gets submitted)
                    option.value = genre.genre_id;
                    
                    // set the display text to show the genre title
                    option.textContent = genre.title;
                    
                    // add this option to the dropdown
                    editSelect.appendChild(option);
                });
            }
        }

        // Citation for populateRelationshipsTable:
        // This function is directly based off of the populateRentalsTable function in rentals.html, which is all my own work.
        // AI was used to transform the rentals function into the relationships function.
        // Prompt: Take this populateRentalsTable function and modify it to fit my relationships table. [Paste in populateRentalsTable, Relationships ddl section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // This function differs in the sense that it populates a relationship table instead of rental table, with different column data and helper functions.
        // populates the relationship table with data passed to it
        function populateRelationshipsTable(relationships) {
            console.log('[TABLE] Populating relationships table with', relationships.length, 'relationships');
            
            // get reference to the table body element where we'll insert rows
            const tbody = document.getElementById('relationshipsTableBody');
            if (!tbody) {
                console.error('[TABLE] Could not find relationshipsTableBody');
                return; // exit early if table body doesn't exist
            }
            
            // remove any existing rows to start fresh
            tbody.innerHTML = '';
            
            // handle the case where no relationships are returned from the API
            if (relationships.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px; color: #666;">
                            No relationships found
                        </td>
                    </tr>
                `;
                return; // exit since there's nothing more to do
            }
            
            // iterate through each relationship and create a table row
            relationships.forEach((relationship, index) => {
                console.log(`[TABLE] Processing relationship ${index + 1}:`, relationship);
                
                // create a new table row element
                const row = document.createElement('tr');
                
                // get the book and genre names using helper functions to show readable names instead of IDs
                const bookTitle = getBookTitle(relationship.book_id);
                const genreTitle = getGenreTitle(relationship.genre_id);
                
                // build the HTML content for this row with relationship data
                // use fallback values ('N/A') if any relationship properties are missing
                row.innerHTML = `
                    <td>${relationship.relationship_id || 'N/A'}</td>
                    <td>${bookTitle}</td>
                    <td>${genreTitle}</td>
                    <td class="actions">
                        <button class="delete-btn" onclick="deleteRelationship(${relationship.relationship_id})">Delete</button>
                    </td>
                `;
                
                // add the completed row to the table body
                tbody.appendChild(row);
            });
            
            console.log(`[TABLE] Successfully populated table with ${relationships.length} relationships`);
        }

        // Citation for populateEditDropdown:
        // This function is directly based off of the populateEditDropdown function in rentals.html, which is all my own work.
        // AI was used to transform the rentals function into the relationships function.
        // Prompt: Take this populateEditDropdown function and modify it to fit my relationships dropdown. [Paste in populateEditDropdown function, Relationships dropdown section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // This function differs in the sense that it populates a relationship dropdown instead of rental dropdown, using helper functions for display.
        // fills a dropdown in the edit form with available relationships
        function populateEditDropdown(relationships) {
            console.log('[DROPDOWN] Populating edit dropdown with', relationships.length, 'relationships');
            
            // get reference to the dropdown select element
            const select = document.getElementById('edit_relationship_id');
            if (!select) {
                console.error('[DROPDOWN] Could not find edit_relationship_id select');
                return; // exit if dropdown element doesn't exist
            }
            
            // reset the dropdown with just the default "select one" option
            select.innerHTML = '<option value="">Select Relationship to Edit</option>';
            
            // add each relationship as a selectable option in the dropdown
            relationships.forEach(relationship => {
                // create a new option element for this relationship
                const option = document.createElement('option');
                
                // set the option's value to the relationship ID (what gets submitted)
                option.value = relationship.relationship_id;
                
                // use helper functions to get book and genre names for display clarity
                const bookTitle = getBookTitle(relationship.book_id);
                const genreTitle = getGenreTitle(relationship.genre_id);
                
                // set the display text to show ID, book title, and genre title
                option.textContent = `${relationship.relationship_id} - ${bookTitle} (${genreTitle})`;
                
                // add this option to the dropdown
                select.appendChild(option);
            });
            
            console.log('[DROPDOWN] Successfully populated dropdown');
        }

        // Citation for loadRelationshipData:
        // This function is directly based off of the loadRentalData function in rentals.html, which is all my own work.
        // AI was used to transform the rentals function into the relationships function.
        // Prompt: Take this loadRentalData function and modify it to fit my relationships form. [Paste in loadRentalData function, Relationships form section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // This function differs in the sense that it loads relationship form data instead of rental form data, and doesn't require date parsing.
        // loads relationship details into the form fields when selected from dropdown
        function loadRelationshipData() {
            console.log('[EDIT] loadRelationshipData() called');
            
            // get the dropdown element and its currently selected value
            const select = document.getElementById('edit_relationship_id');
            const relationshipId = select.value;
            
            console.log('[EDIT] Selected relationship ID:', relationshipId);
            
            // if no relationship is selected, clear the form and exit
            if (!relationshipId) {
                console.log('[EDIT] No relationship selected, clearing form');
                clearEditForm(); // reset all form fields
                return;
            }
            
            // search through our cached relationship data to find the selected relationship
            // use == instead of === to handle string/number comparison
            const relationship = allRelationships.find(r => r.relationship_id == relationshipId);
            console.log('[EDIT] Found relationship data:', relationship);
            
            // handle case where relationship data isn't found in our cache
            if (!relationship) {
                console.error('[EDIT] Relationship not found in stored data');
                showMessage('Relationship data not found', 'error');
                return;
            }
            
            // populate the edit form fields with the selected relationship's current data
            // use fallback empty strings if any properties are missing
            document.getElementById('edit_book').value = relationship.book_id || '';
            document.getElementById('edit_genre').value = relationship.genre_id || '';
            
            console.log('[EDIT] Form populated with relationship data');
        }

        // Citation for deleteRelationship function:
        // This function is directly based off of the deleteRental function in rentals.html, which is all my own work.
        // AI was used to transform the rentals function into the relationships function.
        // Prompt: Take this deleteRental function and modify it to fit my relationships deletion. [Paste in deleteRental function, Relationships deletion section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // This function differs in the sense that it deletes a relationship instead of a rental.
        // sends a DELETE request to remove a relationship
        async function deleteRelationship(relationshipId) {
            console.log('[DELETE] deleteRelationship called for ID:', relationshipId);
            
            // show confirmation dialog to prevent accidental deletions
            if (confirm(`Are you sure you want to delete relationship ${relationshipId}?`)) {
                try {
                    console.log('[DELETE] Sending DELETE request for relationship:', relationshipId);
                    
                    // make HTTP DELETE request to the specific relationship endpoint
                    const response = await fetch(`/api/relationships/${relationshipId}`, {
                        method: 'DELETE'
                    });
                    
                    console.log('[DELETE] Response status:', response.status);
                    
                    // parse the JSON response from the server
                    const result = await response.json();
                    console.log('[DELETE] Response data:', result);
                    
                    // check if the deletion was successful
                    if (response.ok) {
                        console.log('[DELETE] Relationship deleted successfully');
                        
                        // show success message to user
                        showMessage(result.message || 'Relationship deleted successfully', 'success');
                        
                        // refresh the relationship list to reflect the deletion
                        loadRelationships(); // refresh data after deletion
                    } else {
                        // handle server-side errors (relationship not found, etc.)
                        console.error('[DELETE] Error deleting relationship:', result.error);
                        showMessage(result.error || 'Error deleting relationship', 'error');
                    }
                } catch (error) {
                    // handle network errors or other client-side issues
                    console.error('[DELETE] Error deleting relationship:', error);
                    showMessage('Error deleting relationship: ' + error.message, 'error');
                }
            } // if user cancels confirmation, nothing happens
        }

        // Citation for createRelationship function:
        // This function is directly based off of the createRental function in rentals.html, which is all my own work.
        // AI was used to transform the rentals function into the relationships function.
        // Prompt: Take this createRental function and modify it to fit my relationships creation. [Paste in createRental function, Relationships creation section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // This function differs in the sense that it creates a relationship instead of a rental.
        // sends a POST request to create a new relationship
        async function createRelationship(formData) {
            console.log('[CREATE] createRelationship called with data:', formData);
            try {
                console.log('[CREATE] Sending POST request to /api/relationships');
                
                // make HTTP POST request to create a new relationship
                const response = await fetch('/api/relationships', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json', // tell server we're sending JSON
                    },
                    body: JSON.stringify(formData) // convert JavaScript object to JSON string
                });
                
                console.log('[CREATE] Response status:', response.status);
                
                // parse the server's JSON response
                const result = await response.json();
                console.log('[CREATE] Response data:', result);
                
                // check if relationship creation was successful
                if (response.ok) {
                    console.log('[CREATE] Relationship created successfully:', result.message);
                    
                    // show success message to user
                    showMessage(result.message || 'Relationship created successfully', 'success');
                    
                    // clear the add relationship form to prepare for next entry
                    document.getElementById('addRelationshipForm').reset(); // clear form
                    
                    // refresh the relationship list to show the new relationship
                    loadRelationships(); // refresh data
                } else {
                    // handle server-side validation errors or other issues
                    console.error('[CREATE] Error creating relationship:', result.error);
                    showMessage(result.error || 'Error creating relationship', 'error');
                }
            } catch (error) {
                // handle network errors or JSON parsing issues
                console.error('[CREATE] Error creating relationship:', error);
                showMessage('Error creating relationship: ' + error.message, 'error');
            }
        }

        // Citation for updateRelationship:
        // This function is directly based off of the updateRental function in rentals.html, which is all my own work.
        // AI was used to transform the rentals function into the relationships function.
        // Prompt: Take this updateRental function and modify it to fit my relationships updating. [Paste in updateRental function, Relationships updating section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // This function differs in the sense that it updates a relationship instead of a rental.
        // sends a PUT request to update an existing relationship
        async function updateRelationship(relationshipId, formData) {
            console.log('[UPDATE] updateRelationship called for ID:', relationshipId, 'with data:', formData);
            try {
                console.log('[UPDATE] Sending PUT request to /api/relationships/' + relationshipId);
                
                // make HTTP PUT request to update the specific relationship
                const response = await fetch(`/api/relationships/${relationshipId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json', // specify we're sending JSON data
                    },
                    body: JSON.stringify(formData) // convert form data to JSON string
                });
                
                console.log('[UPDATE] Response status:', response.status);
                
                // parse the server's response
                const result = await response.json();
                console.log('[UPDATE] Response data:', result);
                
                // check if the update was successful
                if (response.ok) {
                    console.log('[UPDATE] Relationship updated successfully:', result.message);
                    
                    // show success message to user
                    showMessage(result.message || 'Relationship updated successfully', 'success');
                    
                    // clear the edit form since update is complete
                    clearEditForm();
                    
                    // refresh the relationship list to show updated information
                    loadRelationships(); // refresh data
                } else {
                    // handle server-side validation errors or relationship not found
                    console.error('[UPDATE] Error updating relationship:', result.error);
                    showMessage(result.error || 'Error updating relationship', 'error');
                }
            } catch (error) {
                // handle network errors or JSON parsing issues
                console.error('[UPDATE] Error updating relationship:', error);
                showMessage('Error updating relationship: ' + error.message, 'error');
            }
        }

        // Citation for clearEditForm:
        // AI was used to help me reset the html form.
        // Prompt used: "How do I reset an HTML form in the same file's javascript <script>?""
        // AI Source URL: https://claude.ai
        // Date: 05/2025
        // clears all fields in the edit form by resetting it
        function clearEditForm() {
            console.log('[EDIT] Clearing edit form');
            document.getElementById('editRelationshipForm').reset();
        }

        // Citation for addRelationshipForm event listener:
        // This event listener is directly based off of the createRentalForm event listener in rentals.html, which is all my own work except for:
            // AI tools were used with the prompts, "How do I retrieve a specific element from html formdata in javascript" -> resulting in formData.get,
            // and finally claude suggested to include e.preventDefault to prevent default form behavior.
        // AI was used to transform the rentals event listener into the relationships event listener.
        // Prompt: Take this createRentalForm event listener and modify it to fit my relationships form. [Paste in createRentalForm event listener, Relationships form section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // event listener for add relationship form submission
        document.getElementById('addRelationshipForm').addEventListener('submit', function(e) {
            console.log('[FORM] Add relationship form submitted');
            
            // prevent the browser's default form submission behavior (page reload)
            e.preventDefault(); // prevent default form behavior (page reload)
            
            // extract data from the form using FormData API
            const formData = new FormData(this);
            
            // build a clean JavaScript object with the form data
            // get values from named form fields and parse as integers
            const relationshipData = {
                genre_id: parseInt(formData.get('genre_id')), // parse genre ID as integer
                book_id: parseInt(formData.get('book_id')) // parse book ID as integer
            };
            
            console.log('[FORM] Parsed add relationship data:', relationshipData);
            
            // call the createRelationship function with the collected data
            createRelationship(relationshipData);
        });

        // Citation for editRelationshipForm event listener:
        // This event listener is directly based off of the editRentalForm event listener in rentals.html, which is all my own work except for:
            // AI tools were used with the prompts, "How do I retrieve a specific element from html formdata in javascript" -> resulting in formData.get,
            // and finally claude suggested to include e.preventDefault to prevent default form behavior.
        // AI was used to transform the rentals event listener into the relationships event listener.
        // Prompt: Take this editRentalForm event listener and modify it to fit my relationships form. [Paste in editRentalForm event listener, Relationships form section]
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // event listener for edit relationship form submission
        document.getElementById('editRelationshipForm').addEventListener('submit', function(e) {
            console.log('[FORM] Edit relationship form submitted');
            
            // prevent default browser form submission behavior
            e.preventDefault();
            
            // extract data from the edit form
            const formData = new FormData(this);
            const relationshipId = formData.get('relationship_id');
            
            console.log('[FORM] Selected relationship ID for edit:', relationshipId);
            
            // validate that a relationship has been selected for editing
            if (!relationshipId) {
                console.error('[FORM] No relationship selected for edit');
                showMessage('Please select a relationship to edit', 'error');
                return;
            }
            
            // extract all form data and prepare the payload for update
            const relationshipData = {
                genre_id: parseInt(formData.get('genre_id')), // parse updated genre ID as integer
                book_id: parseInt(formData.get('book_id')) // parse updated book ID as integer
            };
            
            console.log('[FORM] Parsed edit relationship data:', relationshipData);
            
            // call the updateRelationship function with the ID and data
            updateRelationship(relationshipId, relationshipData);
        });

        // Citation for DOMContentLoaded Event listener:
        // This is directly based off of the DOMContentLoaded event listener in rentals.html, which was based on MDN Web Docs - "DOMContentLoaded" event usage pattern
        // However, AI was used to help with refreshing relationships after adding a book.
        // Additional AI help was used to implement Promise.all for coordinated data loading.
        // https://developer.mozilla.org/en-US/docs/Web/API/Document/DOMContentLoaded_event
        // when the page finishes loading, trigger data loading in proper sequence
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[INIT] Page loaded, ready to load data');
            
            // load all data needed for the page in coordinated fashion
            // first load books and genres, then load relationships once those are complete
            Promise.all([loadBooks(), loadGenres()])
                .then(() => {
                    console.log('[INIT] Books and genres loaded, now loading relationships');
                    loadRelationships(); // load relationships after books and genres are available
                })
                .catch(error => {
                    // handle any errors in the initial data loading process
                    console.error('[INIT] Error loading initial data:', error);
                    showMessage('Error loading page data: ' + error.message, 'error');
                });
        });

        // Citation for visibilitychange Event listener:
        // AI was used to help with refreshing relationships after adding a book.
        // This event listener refreshes data when the user returns to the page tab.
        // Prompt: "Help me refresh data when the user comes back to this page tab"
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // add page visibility listener to refresh data when returning to the page
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                console.log('[VISIBILITY] Page became visible, refreshing data');
                
                // reload all data when page becomes visible again (user switched back to tab)
                Promise.all([loadBooks(), loadGenres()])
                    .then(() => {
                        // refresh relationships after books and genres are reloaded
                        loadRelationships();
                    })
                    .catch(error => {
                        // handle errors during data refresh
                        console.error('[VISIBILITY] Error refreshing data:', error);
                    });
            }
        });

        // Citation for window focus Event listener:
        // AI was used to help with refreshing relationships after adding a book.
        // This event listener serves as a fallback to refresh data when the window gains focus.
        // Prompt: "Also add a window focus listener as a fallback for refreshing data"
        // Date: 05/2025
        // AI Source URL: https://claude.ai
        // also add a window focus listener as a fallback for data refresh
        window.addEventListener('focus', function() {
            console.log('[FOCUS] Window focused, refreshing relationships');
            
            // refresh relationships when window gains focus as additional data refresh trigger
            loadRelationships();
        });
    </script>

    <footer>
        <p>Andrew Fief, Ekansh Arora © 2025 Library Management System</p>
    </footer>
</body>
</html>